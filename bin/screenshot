#!/usr/bin/env ruby
# *************************************
#
#   Screenshot
#   -> Capture website images
#
# *************************************

# -------------------------------------
#   Dependencies
# -------------------------------------

require 'json'
require 'net/http'
require 'slugify'

# -------------------------------------
#   Config
# -------------------------------------

#data = 'https://api.airtable.com/v0/apptKHbxmAAcPuZMW/specimens?api_key=key3GGb7zxleGAfHl&sortField=Title'
data = 'https://api.airtable.com/v0/apptKHbxmAAcPuZMW/demo?api_key=key3GGb7zxleGAfHl&sortField=Title'

# -------------------------------------
#   Main
# -------------------------------------

# ----- JSON ----- #

response = Net::HTTP.get(URI(data))
sites    = JSON.parse(response)['records']

# ----- Do the Thing ----- #

for site in sites do
  slug = site['fields']['Title'].slugify
  url  = site['fields']['URL']

  puts "Capturing #{site['fields']['Title']}"

  system "webkit2png --width=1100 --fullsize --ignore-ssl-check --dir=screenshots --filename #{slug} #{url}"
  system "mv screenshots/#{slug}-full.png screenshots/#{slug}.png"
end
